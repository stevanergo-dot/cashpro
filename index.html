<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CashPro</title>
<link rel="manifest" href="manifest.json">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-slate-900 text-white min-h-screen p-4">

<h1 class="text-2xl font-bold mb-6">CashPro</h1>

<!-- TOTAL CARD -->
<div class="bg-slate-800 p-4 rounded-2xl mb-6 shadow-lg">
  <p class="text-slate-400">Total Saldo</p>
  <h2 id="totalBalance" class="text-3xl font-bold text-blue-400"></h2>
</div>

<!-- INPUT CARD -->
<div class="bg-slate-800 p-4 rounded-2xl mb-6 shadow-lg space-y-3">

  <select id="accountType" class="w-full p-2 rounded text-black">
    <option value="Cash">Cash</option>
    <option value="Bank">Bank</option>
    <option value="Ewallet">Ewallet</option>
  </select>

  <input id="amount" type="number" placeholder="Jumlah" 
         class="w-full p-2 rounded text-black"/>

  <select id="type" class="w-full p-2 rounded text-black">
    <option value="income">Income</option>
    <option value="expense">Expense</option>
  </select>

  <button onclick="addTransaction()" 
          class="w-full bg-blue-600 py-2 rounded-xl font-semibold">
    Tambah Transaksi
  </button>

</div>

<!-- SUMMARY -->
<div class="grid grid-cols-2 gap-4 mb-6">
  <div class="bg-slate-800 p-4 rounded-2xl">
    <p class="text-slate-400">Income</p>
    <p id="incomeTotal" class="text-green-400 font-bold text-lg"></p>
  </div>
  <div class="bg-slate-800 p-4 rounded-2xl">
    <p class="text-slate-400">Expense</p>
    <p id="expenseTotal" class="text-red-400 font-bold text-lg"></p>
  </div>
</div>

<!-- CHART -->
<div class="bg-slate-800 p-4 rounded-2xl mb-6">
  <canvas id="chart"></canvas>
</div>

<!-- TRANSACTIONS -->
<div class="bg-slate-800 p-4 rounded-2xl">
  <h3 class="mb-3 font-semibold">Riwayat Transaksi</h3>
  <div id="history" class="space-y-2 text-sm"></div>
</div>

<script>
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js")
}

let data = JSON.parse(localStorage.getItem("cashpro")) || {
  accounts:{Cash:0,Bank:0,Ewallet:0},
  transactions:[]
}

function save(){
  localStorage.setItem("cashpro",JSON.stringify(data))
}

function addTransaction(){
  const acc = accountType.value
  const amt = parseInt(amount.value||0)
  const typeVal = type.value

  if(typeVal==="income") data.accounts[acc]+=amt
  else data.accounts[acc]-=amt

  data.transactions.push({acc,amt,typeVal,date:new Date().toLocaleDateString()})
  save()
  render()
}

function render(){
  const total = Object.values(data.accounts).reduce((a,b)=>a+b,0)
  totalBalance.innerText = "Rp "+total.toLocaleString()

  let income = 0
  let expense = 0

  data.transactions.forEach(t=>{
    if(t.typeVal==="income") income+=t.amt
    else expense+=t.amt
  })

  incomeTotal.innerText = "Rp "+income.toLocaleString()
  expenseTotal.innerText = "Rp "+expense.toLocaleString()

  const ctx = document.getElementById("chart")
  new Chart(ctx,{
    type:"doughnut",
    data:{
      labels:Object.keys(data.accounts),
      datasets:[{
        data:Object.values(data.accounts)
      }]
    }
  })

  history.innerHTML = data.transactions
    .slice().reverse()
    .map(t=>`
      <div class="flex justify-between">
        <span>${t.acc}</span>
        <span class="${t.typeVal==='income'?'text-green-400':'text-red-400'}">
          ${t.typeVal==='income'?'+':'-'} Rp ${t.amt.toLocaleString()}
        </span>
      </div>
    `).join("")
}

render()
</script>

</body>
</html>
